#height = expression_heatmap_height(),
# xgap = 4,
# ygap = 4,
type = "heatmap",
#colorscale= color_scale,
zauto = TRUE,
#zmin = colorscale_min,
#zmax = colorscale_max,
#reversescale = FALSE,
# colorbar = list(
#   title = "Expression",
#   lenmode = "pixels",
#   len = 120
# )
)%>%
plotly::layout(
title = "",
xaxis = list(
title = "",
mirror = TRUE,
autorange = TRUE,
#dtick = 1,
showline = FALSE,
type = "category"
# categoryorder = "array",    # "category ascending" does not work for heatmaps
# categoryarray = sort(unique(expression_heatmap_data()$clusters))
),
yaxis = list(
#title = "Gene(s)",
autorange = TRUE,
hoverformat = ".2f",
mirror = TRUE,
#dtick = 1,
showline = FALSE
),
dragmode =  "select",
hovermode = "compare"
)
map <- ggplotly(map)  %>% # here it seems layout can be formatted like in ggplot.
layout(
xaxis = list(tickfont = list(size = 10)),
yaxis = list(tickfont = list(size = 7)))
map
# cluster and order genes (across reference cell types only)
ref_clust_genes <- hclust(dist(log2(data[,1:5] + 1)), method = 'average')
data <- data[ref_clust_genes$order,]
data_filt <- reduce_data(reference, sample, markers)
ref_filt <- data_filt$ref_filt
# order cell types according to spearman
cor <- cor_data(reduce_data(reference, sample, markers))
cor <- cor[1:dim(ref_filt)[2],]
ref_filt <- ref_filt[,order(cor$rho, decreasing = T)]
test_filt <- data_filt$test_filt
data <- cbind(test_filt,ref_filt)
# cluster and order genes (across reference cell types only)
ref_clust_genes <- hclust(dist(log2(data[,1:5] + 1)), method = 'average')
data <- data[ref_clust_genes$order,]
# log2 transformation
data_log2 <- log2(data + 1)
#scale by row
scale_log2 <- t(apply(data_log2, 1, normalize_expression_by_row))
map <- plotly::plot_ly(
z = as.matrix(scale_log2),
x = colnames(data_log2),
y = rownames(data_log2),
#height = expression_heatmap_height(),
# xgap = 4,
# ygap = 4,
type = "heatmap",
#colorscale= color_scale,
zauto = TRUE,
#zmin = colorscale_min,
#zmax = colorscale_max,
#reversescale = FALSE,
# colorbar = list(
#   title = "Expression",
#   lenmode = "pixels",
#   len = 120
# )
)%>%
plotly::layout(
title = "",
xaxis = list(
title = "",
mirror = TRUE,
autorange = TRUE,
#dtick = 1,
showline = FALSE,
type = "category"
# categoryorder = "array",    # "category ascending" does not work for heatmaps
# categoryarray = sort(unique(expression_heatmap_data()$clusters))
),
yaxis = list(
#title = "Gene(s)",
autorange = TRUE,
hoverformat = ".2f",
mirror = TRUE,
#dtick = 1,
showline = FALSE
),
dragmode =  "select",
hovermode = "compare"
)
map <- ggplotly(map)  %>% # here it seems layout can be formatted like in ggplot.
layout(
xaxis = list(tickfont = list(size = 10)),
yaxis = list(tickfont = list(size = 7)))
map
scale_log2 <- data_log2
map <- plotly::plot_ly(
z = as.matrix(scale_log2),
x = colnames(data_log2),
y = rownames(data_log2),
#height = expression_heatmap_height(),
# xgap = 4,
# ygap = 4,
type = "heatmap",
#colorscale= color_scale,
zauto = TRUE,
#zmin = colorscale_min,
#zmax = colorscale_max,
#reversescale = FALSE,
# colorbar = list(
#   title = "Expression",
#   lenmode = "pixels",
#   len = 120
# )
)%>%
plotly::layout(
title = "",
xaxis = list(
title = "",
mirror = TRUE,
autorange = TRUE,
#dtick = 1,
showline = FALSE,
type = "category"
# categoryorder = "array",    # "category ascending" does not work for heatmaps
# categoryarray = sort(unique(expression_heatmap_data()$clusters))
),
yaxis = list(
#title = "Gene(s)",
autorange = TRUE,
hoverformat = ".2f",
mirror = TRUE,
#dtick = 1,
showline = FALSE
),
dragmode =  "select",
hovermode = "compare"
)
map <- ggplotly(map)  %>% # here it seems layout can be formatted like in ggplot.
layout(
xaxis = list(tickfont = list(size = 10)),
yaxis = list(tickfont = list(size = 7)))
map
data_filt <- reduce_data(reference, sample, markers)
ref_filt <- data_filt$ref_filt
# order cell types according to spearman
cor <- cor_data(reduce_data(reference, sample, markers))
cor <- cor[1:dim(ref_filt)[2],]
ref_filt <- ref_filt[,order(cor$rho, decreasing = T)]
test_filt <- data_filt$test_filt
data <- cbind(test_filt,ref_filt)
# cluster and order genes (across reference cell types only)
ref_clust_genes <- hclust(dist(log2(data[,1:4] + 1)), method = 'average')
data <- data[ref_clust_genes$order,]
# log2 transformation
data_log2 <- log2(data + 1)
#scale by row
scale_log2 <- t(apply(data_log2, 1, normalize_expression_by_row))
scale_log2 <- data_log2
map <- plotly::plot_ly(
z = as.matrix(scale_log2),
x = colnames(data_log2),
y = rownames(data_log2),
#height = expression_heatmap_height(),
# xgap = 4,
# ygap = 4,
type = "heatmap",
#colorscale= color_scale,
zauto = TRUE,
#zmin = colorscale_min,
#zmax = colorscale_max,
#reversescale = FALSE,
# colorbar = list(
#   title = "Expression",
#   lenmode = "pixels",
#   len = 120
# )
)%>%
plotly::layout(
title = "",
xaxis = list(
title = "",
mirror = TRUE,
autorange = TRUE,
#dtick = 1,
showline = FALSE,
type = "category"
# categoryorder = "array",    # "category ascending" does not work for heatmaps
# categoryarray = sort(unique(expression_heatmap_data()$clusters))
),
yaxis = list(
#title = "Gene(s)",
autorange = TRUE,
hoverformat = ".2f",
mirror = TRUE,
#dtick = 1,
showline = FALSE
),
dragmode =  "select",
hovermode = "compare"
)
map <- ggplotly(map)  %>% # here it seems layout can be formatted like in ggplot.
layout(
xaxis = list(tickfont = list(size = 10)),
yaxis = list(tickfont = list(size = 7)))
map
data_filt <- reduce_data(reference, sample, markers)
ref_filt <- data_filt$ref_filt
# order cell types according to spearman
cor <- cor_data(reduce_data(reference, sample, markers))
cor <- cor[1:dim(ref_filt)[2],]
ref_filt <- ref_filt[,order(cor$rho, decreasing = T)]
test_filt <- data_filt$test_filt
data <- cbind(test_filt,ref_filt)
# cluster and order genes (across reference cell types only)
ref_clust_genes <- hclust(dist(log2(ref_filt[,1:4] + 1)), method = 'average')
data <- data[ref_clust_genes$order,]
# log2 transformation
data_log2 <- log2(data + 1)
#scale by row
scale_log2 <- t(apply(data_log2, 1, normalize_expression_by_row))
scale_log2 <- data_log2
map <- plotly::plot_ly(
z = as.matrix(scale_log2),
x = colnames(data_log2),
y = rownames(data_log2),
#height = expression_heatmap_height(),
# xgap = 4,
# ygap = 4,
type = "heatmap",
#colorscale= color_scale,
zauto = TRUE,
#zmin = colorscale_min,
#zmax = colorscale_max,
#reversescale = FALSE,
# colorbar = list(
#   title = "Expression",
#   lenmode = "pixels",
#   len = 120
# )
)%>%
plotly::layout(
title = "",
xaxis = list(
title = "",
mirror = TRUE,
autorange = TRUE,
#dtick = 1,
showline = FALSE,
type = "category"
# categoryorder = "array",    # "category ascending" does not work for heatmaps
# categoryarray = sort(unique(expression_heatmap_data()$clusters))
),
yaxis = list(
#title = "Gene(s)",
autorange = TRUE,
hoverformat = ".2f",
mirror = TRUE,
#dtick = 1,
showline = FALSE
),
dragmode =  "select",
hovermode = "compare"
)
map <- ggplotly(map)  %>% # here it seems layout can be formatted like in ggplot.
layout(
xaxis = list(tickfont = list(size = 10)),
yaxis = list(tickfont = list(size = 7)))
map
#scale by row
scale_log2 <- t(apply(data_log2, 1, normalize_expression_by_row))
map <- plotly::plot_ly(
z = as.matrix(scale_log2),
x = colnames(data_log2),
y = rownames(data_log2),
#height = expression_heatmap_height(),
# xgap = 4,
# ygap = 4,
type = "heatmap",
#colorscale= color_scale,
zauto = TRUE,
#zmin = colorscale_min,
#zmax = colorscale_max,
#reversescale = FALSE,
# colorbar = list(
#   title = "Expression",
#   lenmode = "pixels",
#   len = 120
# )
)%>%
plotly::layout(
title = "",
xaxis = list(
title = "",
mirror = TRUE,
autorange = TRUE,
#dtick = 1,
showline = FALSE,
type = "category"
# categoryorder = "array",    # "category ascending" does not work for heatmaps
# categoryarray = sort(unique(expression_heatmap_data()$clusters))
),
yaxis = list(
#title = "Gene(s)",
autorange = TRUE,
hoverformat = ".2f",
mirror = TRUE,
#dtick = 1,
showline = FALSE
),
dragmode =  "select",
hovermode = "compare"
)
map <- ggplotly(map)  %>% # here it seems layout can be formatted like in ggplot.
layout(
xaxis = list(tickfont = list(size = 10)),
yaxis = list(tickfont = list(size = 7)))
map
data_filt <- reduce_data(reference, sample, markers)
ref_filt <- data_filt$ref_filt
# order cell types according to spearman
cor <- cor_data(reduce_data(reference, sample, markers))
cor <- cor[1:dim(ref_filt)[2],]
ref_filt <- ref_filt[,order(cor$rho, decreasing = T)]
test_filt <- data_filt$test_filt
data <- cbind(test_filt,ref_filt)
# cluster and order genes (across reference cell types only)
ref_clust_genes <- hclust(dist(log2(ref_filt[,] + 1)), method = 'average')
data <- data[ref_clust_genes$order,]
# log2 transformation
data_log2 <- log2(data + 1)
#scale by row
scale_log2 <- t(apply(data_log2, 1, normalize_expression_by_row))
map <- plotly::plot_ly(
z = as.matrix(scale_log2),
x = colnames(data_log2),
y = rownames(data_log2),
#height = expression_heatmap_height(),
# xgap = 4,
# ygap = 4,
type = "heatmap",
#colorscale= color_scale,
zauto = TRUE,
#zmin = colorscale_min,
#zmax = colorscale_max,
#reversescale = FALSE,
# colorbar = list(
#   title = "Expression",
#   lenmode = "pixels",
#   len = 120
# )
)%>%
plotly::layout(
title = "",
xaxis = list(
title = "",
mirror = TRUE,
autorange = TRUE,
#dtick = 1,
showline = FALSE,
type = "category"
# categoryorder = "array",    # "category ascending" does not work for heatmaps
# categoryarray = sort(unique(expression_heatmap_data()$clusters))
),
yaxis = list(
#title = "Gene(s)",
autorange = TRUE,
hoverformat = ".2f",
mirror = TRUE,
#dtick = 1,
showline = FALSE
),
dragmode =  "select",
hovermode = "compare"
)
map <- ggplotly(map)  %>% # here it seems layout can be formatted like in ggplot.
layout(
xaxis = list(tickfont = list(size = 10)),
yaxis = list(tickfont = list(size = 7)))
map
# cluster and order genes (across reference cell types only)
ref_clust_genes <- hclust(dist(log2(ref_filt[,] + 1)), method = 'Ward.D2')
help(hclust)
data_filt <- reduce_data(reference, sample, markers)
ref_filt <- data_filt$ref_filt
# order cell types according to spearman
cor <- cor_data(reduce_data(reference, sample, markers))
cor <- cor[1:dim(ref_filt)[2],]
ref_filt <- ref_filt[,order(cor$rho, decreasing = T)]
test_filt <- data_filt$test_filt
data <- cbind(test_filt,ref_filt)
# cluster and order genes (across reference cell types only)
ref_clust_genes <- hclust(dist(log2(ref_filt[,] + 1)), method = 'ward.D2')
data <- data[ref_clust_genes$order,]
help(hclust)
# log2 transformation
data_log2 <- log2(data + 1)
#scale by row
scale_log2 <- t(apply(data_log2, 1, normalize_expression_by_row))
map <- plotly::plot_ly(
z = as.matrix(scale_log2),
x = colnames(data_log2),
y = rownames(data_log2),
#height = expression_heatmap_height(),
# xgap = 4,
# ygap = 4,
type = "heatmap",
#colorscale= color_scale,
zauto = TRUE,
#zmin = colorscale_min,
#zmax = colorscale_max,
#reversescale = FALSE,
# colorbar = list(
#   title = "Expression",
#   lenmode = "pixels",
#   len = 120
# )
)%>%
plotly::layout(
title = "",
xaxis = list(
title = "",
mirror = TRUE,
autorange = TRUE,
#dtick = 1,
showline = FALSE,
type = "category"
# categoryorder = "array",    # "category ascending" does not work for heatmaps
# categoryarray = sort(unique(expression_heatmap_data()$clusters))
),
yaxis = list(
#title = "Gene(s)",
autorange = TRUE,
hoverformat = ".2f",
mirror = TRUE,
#dtick = 1,
showline = FALSE
),
dragmode =  "select",
hovermode = "compare"
)
map <- ggplotly(map)  %>% # here it seems layout can be formatted like in ggplot.
layout(
xaxis = list(tickfont = list(size = 10)),
yaxis = list(tickfont = list(size = 7)))
map
scale_log2 <- data_log2
map <- plotly::plot_ly(
z = as.matrix(scale_log2),
x = colnames(data_log2),
y = rownames(data_log2),
#height = expression_heatmap_height(),
# xgap = 4,
# ygap = 4,
type = "heatmap",
#colorscale= color_scale,
zauto = TRUE,
#zmin = colorscale_min,
#zmax = colorscale_max,
#reversescale = FALSE,
# colorbar = list(
#   title = "Expression",
#   lenmode = "pixels",
#   len = 120
# )
)%>%
plotly::layout(
title = "",
xaxis = list(
title = "",
mirror = TRUE,
autorange = TRUE,
#dtick = 1,
showline = FALSE,
type = "category"
# categoryorder = "array",    # "category ascending" does not work for heatmaps
# categoryarray = sort(unique(expression_heatmap_data()$clusters))
),
yaxis = list(
#title = "Gene(s)",
autorange = TRUE,
hoverformat = ".2f",
mirror = TRUE,
#dtick = 1,
showline = FALSE
),
dragmode =  "select",
hovermode = "compare"
)
map <- ggplotly(map)  %>% # here it seems layout can be formatted like in ggplot.
layout(
xaxis = list(tickfont = list(size = 10)),
yaxis = list(tickfont = list(size = 7)))
map
shiny::runApp('D:/GenEpi/CellMatchR/S1 Group Folder/CellMatchR/04_Scripts/03_Shiny/CellMatchR')
runApp('D:/GenEpi/CellMatchR/S1 Group Folder/CellMatchR/04_Scripts/03_Shiny/CellMatchR')
nov <- read.csv("../data/novella_russell_pseudobulk_cpm_IDs.csv")
View(nov)
colnames(nov)
